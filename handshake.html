<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handshake Diagrams</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap');

  :root {
    --bg: #0a0a0f;
    --panel: #11111a;
    --border: #1e1e2e;
    --text: #e0e0f0;
    --muted: #5a5a7a;
    --two: #00e5ff;
    --three: #69ff47;
    --four: #ff6b6b;
    --accent: #b388ff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    padding: 2rem 1rem 3rem;
  }

  h1 {
    text-align: center;
    font-size: clamp(1.4rem, 4vw, 2.2rem);
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 0.3rem;
    background: linear-gradient(90deg, var(--two), var(--three), var(--four));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .subtitle {
    text-align: center;
    color: var(--muted);
    font-size: 0.85rem;
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 2.5rem;
    letter-spacing: 0.05em;
  }

  .tabs {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .tab {
    padding: 0.5rem 1.4rem;
    border-radius: 2rem;
    border: 1.5px solid var(--border);
    background: var(--panel);
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }

  .tab:hover { border-color: var(--accent); color: var(--text); }
  .tab.active-two { border-color: var(--two); color: var(--two); background: rgba(0,229,255,0.08); }
  .tab.active-three { border-color: var(--three); color: var(--three); background: rgba(105,255,71,0.08); }
  .tab.active-four { border-color: var(--four); color: var(--four); background: rgba(255,107,107,0.08); }
  .tab.active-half { border-color: #f9a825; color: #f9a825; background: rgba(249,168,37,0.08); }

  .diagram-container {
    display: none;
    max-width: 780px;
    margin: 0 auto;
    animation: fadeIn 0.3s ease;
  }
  .diagram-container.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .diagram-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 2rem;
    font-weight: 700;
    padding: 0.2rem 0.8rem;
    border-radius: 0.4rem;
  }

  .badge-two { color: var(--two); border: 2px solid var(--two); background: rgba(0,229,255,0.06); }
  .badge-three { color: var(--three); border: 2px solid var(--three); background: rgba(105,255,71,0.06); }
  .badge-four { color: var(--four); border: 2px solid var(--four); background: rgba(255,107,107,0.06); }

  .header-text h2 { font-size: 1.3rem; font-weight: 700; }
  .header-text p { color: var(--muted); font-size: 0.82rem; font-family: 'JetBrains Mono', monospace; margin-top: 0.2rem; }

  /* DIAGRAM CANVAS */
  .canvas {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 1rem;
    padding: 2rem 1.5rem 2rem 3rem;
    position: relative;
    margin-bottom: 1.5rem;
    overflow: visible;
  }

  .actors {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1.5rem;
  }

  .actor {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.4rem;
    width: 90px;
  }

  .actor-icon {
    width: 52px;
    height: 52px;
    border-radius: 0.6rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
  }

  .actor-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    color: var(--muted);
    text-transform: uppercase;
  }

  .lifelines {
    position: relative;
    padding: 0 45px 0 45px;
    overflow: visible;
  }

  .lifeline-client, .lifeline-server {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 1px;
    border-left: 1.5px dashed var(--border);
  }
  .lifeline-client { left: 45px; }
  .lifeline-server { right: 45px; }

  .step {
    display: flex;
    align-items: center;
    margin-bottom: 1.8rem;
    position: relative;
  }

  .arrow-row {
    opacity: 0;
    transform: translateX(-8px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .arrow-row.visible { opacity: 1; transform: translateX(0); }

  .step-num {
    position: absolute;
    left: -2.2rem;
    width: 1.6rem;
    height: 1.6rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.7rem;
    font-weight: 700;
    flex-shrink: 0;
    z-index: 10;
  }

  .arrow-row {
    display: flex;
    align-items: center;
    width: 100%;
    position: relative;
  }

  .arrow-line {
    flex: 1;
    height: 2px;
    position: relative;
  }

  .arrow-line::after {
    content: '';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-top: 2px solid;
    border-right: 2px solid;
  }

  .arrow-right .arrow-line::after {
    right: -1px;
    transform: translateY(-50%) rotate(45deg);
    border-color: inherit;
  }

  .arrow-left .arrow-line::after {
    left: -1px;
    transform: translateY(-50%) rotate(-135deg);
    border-color: inherit;
  }

  .dot-start, .dot-end {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .msg-label {
    position: absolute;
    top: -1.3rem;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    white-space: nowrap;
    padding: 0.1rem 0.5rem;
    border-radius: 0.2rem;
    font-weight: 700;
  }

  .msg-desc {
    position: absolute;
    bottom: -1.1rem;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.65rem;
    white-space: nowrap;
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
  }

  /* Colors per type */
  .c-two { color: var(--two); }
  .c-three { color: var(--three); }
  .c-four { color: var(--four); }

  .bg-two { background: rgba(0,229,255,0.12); border-color: var(--two); }
  .bg-three { background: rgba(105,255,71,0.12); border-color: var(--three); }
  .bg-four { background: rgba(255,107,107,0.12); border-color: var(--four); }

  .line-two { background: var(--two); }
  .line-three { background: var(--three); }
  .line-four { background: var(--four); }

  .dot-two { background: var(--two); }
  .dot-three { background: var(--three); }
  .dot-four { background: var(--four); }

  .label-two { background: rgba(0,229,255,0.15); color: var(--two); }
  .label-three { background: rgba(105,255,71,0.15); color: var(--three); }
  .label-four { background: rgba(255,107,107,0.15); color: var(--four); }

  /* Info cards */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.8rem;
    margin-bottom: 1.5rem;
  }

  .info-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 0.7rem;
    padding: 0.9rem 1rem;
  }

  .info-card .label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    margin-bottom: 0.3rem;
  }

  .info-card .value {
    font-size: 0.9rem;
    font-weight: 700;
  }

  .use-cases {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 0.7rem;
    padding: 1rem 1.2rem;
  }

  .use-cases h3 {
    font-size: 0.72rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
    margin-bottom: 0.6rem;
  }

  .use-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .use-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.72rem;
    padding: 0.2rem 0.6rem;
    border-radius: 0.3rem;
    border: 1px solid;
  }

  /* Play button */
  .controls {
    display: flex;
    justify-content: center;
    margin-bottom: 1.5rem;
  }

  .play-btn {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.8rem;
    padding: 0.5rem 1.5rem;
    border-radius: 2rem;
    border: 1.5px solid;
    cursor: pointer;
    background: transparent;
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }

  .play-two { border-color: var(--two); color: var(--two); }
  .play-two:hover { background: rgba(0,229,255,0.1); }
  .play-three { border-color: var(--three); color: var(--three); }
  .play-three:hover { background: rgba(105,255,71,0.1); }
  .play-four { border-color: var(--four); color: var(--four); }
  .play-four:hover { background: rgba(255,107,107,0.1); }

  .comparison {
    max-width: 780px;
    margin: 2.5rem auto 0;
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 1rem;
    overflow: hidden;
  }

  .comparison h3 {
    padding: 1rem 1.5rem;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--muted);
    font-family: 'JetBrains Mono', monospace;
    border-bottom: 1px solid var(--border);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.78rem;
  }

  th {
    padding: 0.7rem 1rem;
    text-align: left;
    color: var(--muted);
    font-size: 0.68rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    border-bottom: 1px solid var(--border);
  }

  td {
    padding: 0.65rem 1rem;
    border-bottom: 1px solid rgba(30,30,46,0.5);
  }

  tr:last-child td { border-bottom: none; }
</style>
</head>
<body>

<h1>Handshake Diagrams</h1>
<p class="subtitle">// click a type to explore ¬∑ press ‚ñ∂ ANIMATE to replay</p>

<div class="tabs">
  <button class="tab active-two" onclick="show('two')">2-Way</button>
  <button class="tab" onclick="show('three')">3-Way</button>
  <button class="tab" onclick="show('four')">4-Way</button>
  <button class="tab" onclick="show('half')">Half-Close + Reconnect</button>
</div>

<!-- ===================== 2-WAY ===================== -->
<div class="diagram-container active" id="d-two">
  <div class="diagram-header">
    <div class="badge badge-two">2√ó</div>
    <div class="header-text">
      <h2>Two-Way Handshake</h2>
      <p>Request ‚Üí Response &nbsp;|&nbsp; 1 round trip &nbsp;|&nbsp; Simple but limited</p>
    </div>
  </div>

  <div class="controls">
    <button class="play-btn play-two" onclick="animate('two')">‚ñ∂ ANIMATE</button>
  </div>

  <div class="canvas">
    <div class="actors">
      <div class="actor">
        <div class="actor-icon" style="background:rgba(0,229,255,0.1);border:1.5px solid var(--two)">üíª</div>
        <div class="actor-label">Client</div>
      </div>
      <div class="actor">
        <div class="actor-icon" style="background:rgba(0,229,255,0.1);border:1.5px solid var(--two)">üñ•Ô∏è</div>
        <div class="actor-label">Server</div>
      </div>
    </div>

    <div class="lifelines">
      <div class="lifeline-client"></div>
      <div class="lifeline-server"></div>

      <!-- Step 1 -->
      <div class="step" id="two-s1" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(0,229,255,0.2);color:var(--two);">1</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start dot-two"></div>
          <div class="arrow-line line-two" style="border-color:var(--two)">
            <span class="msg-label label-two">REQUEST</span>
            <span class="msg-desc">"Hello, I need data"</span>
          </div>
          <div class="dot-end dot-two"></div>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="step" id="two-s2" style="margin-bottom:0.5rem">
        <span class="step-num" style="background:rgba(0,229,255,0.2);color:var(--two);">2</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start dot-two"></div>
          <div class="arrow-line line-two" style="border-color:var(--two)">
            <span class="msg-label label-two">RESPONSE</span>
            <span class="msg-desc">"Here's your data"</span>
          </div>
          <div class="dot-end dot-two"></div>
        </div>
      </div>

    </div>
  </div>

  <div class="info-grid">
    <div class="info-card">
      <div class="label">Round Trips</div>
      <div class="value c-two">1.0 RTT</div>
    </div>
    <div class="info-card">
      <div class="label">Messages</div>
      <div class="value c-two">2 total</div>
    </div>
    <div class="info-card">
      <div class="label">Bidirectional confirm</div>
      <div class="value" style="color:#ff6b6b">‚úó No</div>
    </div>
    <div class="info-card">
      <div class="label">Vulnerability</div>
      <div class="value" style="color:#ff6b6b;font-size:0.8rem">Replay attacks</div>
    </div>
  </div>

  <div class="use-cases">
    <h3>Real-World Examples</h3>
    <div class="use-list">
      <span class="use-tag" style="color:var(--two);border-color:rgba(0,229,255,0.3)">API Key Auth</span>
      <span class="use-tag" style="color:var(--two);border-color:rgba(0,229,255,0.3)">Basic HTTP/1.0</span>
      <span class="use-tag" style="color:var(--two);border-color:rgba(0,229,255,0.3)">Simple Webhooks</span>
      <span class="use-tag" style="color:var(--two);border-color:rgba(0,229,255,0.3)">UDP (no confirm)</span>
    </div>
  </div>
</div>

<!-- ===================== 3-WAY ===================== -->
<div class="diagram-container" id="d-three">
  <div class="diagram-header">
    <div class="badge badge-three">3√ó</div>
    <div class="header-text">
      <h2>Three-Way Handshake</h2>
      <p>SYN ‚Üí SYN-ACK ‚Üí ACK &nbsp;|&nbsp; 1.5 round trips &nbsp;|&nbsp; TCP standard</p>
    </div>
  </div>

  <div class="controls">
    <button class="play-btn play-three" onclick="animate('three')">‚ñ∂ ANIMATE</button>
  </div>

  <div class="canvas">
    <div class="actors">
      <div class="actor">
        <div class="actor-icon" style="background:rgba(105,255,71,0.08);border:1.5px solid var(--three)">üíª</div>
        <div class="actor-label">Client</div>
      </div>
      <div class="actor">
        <div class="actor-icon" style="background:rgba(105,255,71,0.08);border:1.5px solid var(--three)">üñ•Ô∏è</div>
        <div class="actor-label">Server</div>
      </div>
    </div>

    <div class="lifelines">
      <div class="lifeline-client"></div>
      <div class="lifeline-server"></div>

      <div class="step" id="three-s1" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(105,255,71,0.15);color:var(--three);">1</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start dot-three"></div>
          <div class="arrow-line line-three">
            <span class="msg-label label-three">SYN</span>
            <span class="msg-desc">seq=100 &nbsp;"Can we connect?"</span>
          </div>
          <div class="dot-end dot-three"></div>
        </div>
      </div>

      <div class="step" id="three-s2" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(105,255,71,0.15);color:var(--three);">2</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start dot-three"></div>
          <div class="arrow-line line-three">
            <span class="msg-label label-three">SYN-ACK</span>
            <span class="msg-desc">seq=200, ack=101 &nbsp;"Yes! Ready"</span>
          </div>
          <div class="dot-end dot-three"></div>
        </div>
      </div>

      <div class="step" id="three-s3" style="margin-bottom:0.5rem">
        <span class="step-num" style="background:rgba(105,255,71,0.15);color:var(--three);">3</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start dot-three"></div>
          <div class="arrow-line line-three">
            <span class="msg-label label-three">ACK</span>
            <span class="msg-desc">ack=201 &nbsp;"Got it, let's go!"</span>
          </div>
          <div class="dot-end dot-three"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-card">
      <div class="label">Round Trips</div>
      <div class="value c-three">1.5 RTT</div>
    </div>
    <div class="info-card">
      <div class="label">Messages</div>
      <div class="value c-three">3 total</div>
    </div>
    <div class="info-card">
      <div class="label">Bidirectional confirm</div>
      <div class="value" style="color:var(--three)">‚úì Yes</div>
    </div>
    <div class="info-card">
      <div class="label">Why 3rd msg?</div>
      <div class="value" style="color:var(--three);font-size:0.78rem">Proves client got SYN-ACK</div>
    </div>
  </div>

  <div class="use-cases">
    <h3>Real-World Examples</h3>
    <div class="use-list">
      <span class="use-tag" style="color:var(--three);border-color:rgba(105,255,71,0.3)">TCP (all APIs)</span>
      <span class="use-tag" style="color:var(--three);border-color:rgba(105,255,71,0.3)">TLS 1.2 setup</span>
      <span class="use-tag" style="color:var(--three);border-color:rgba(105,255,71,0.3)">OAuth 2.0 flow</span>
      <span class="use-tag" style="color:var(--three);border-color:rgba(105,255,71,0.3)">REST / GraphQL</span>
      <span class="use-tag" style="color:var(--three);border-color:rgba(105,255,71,0.3)">gRPC</span>
    </div>
  </div>
</div>

<!-- ===================== 4-WAY ===================== -->
<div class="diagram-container" id="d-four">
  <div class="diagram-header">
    <div class="badge badge-four">4√ó</div>
    <div class="header-text">
      <h2>Four-Way Handshake</h2>
      <p>FIN‚ÜíACK‚ÜíFIN‚ÜíACK &nbsp;|&nbsp; 2 round trips &nbsp;|&nbsp; TCP teardown / WPA2</p>
    </div>
  </div>

  <div class="controls">
    <button class="play-btn play-four" onclick="animate('four')">‚ñ∂ ANIMATE</button>
  </div>

  <div class="canvas">
    <div class="actors">
      <div class="actor">
        <div class="actor-icon" style="background:rgba(255,107,107,0.08);border:1.5px solid var(--four)">üíª</div>
        <div class="actor-label">Client</div>
      </div>
      <div class="actor">
        <div class="actor-icon" style="background:rgba(255,107,107,0.08);border:1.5px solid var(--four)">üñ•Ô∏è</div>
        <div class="actor-label">Server</div>
      </div>
    </div>

    <div class="lifelines">
      <div class="lifeline-client"></div>
      <div class="lifeline-server"></div>

      <div class="step" id="four-s1" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(255,107,107,0.15);color:var(--four);">1</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start dot-four"></div>
          <div class="arrow-line line-four">
            <span class="msg-label label-four">FIN</span>
            <span class="msg-desc">seq=300 &nbsp;"I'm done sending"</span>
          </div>
          <div class="dot-end dot-four"></div>
        </div>
      </div>

      <div class="step" id="four-s2" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(255,107,107,0.15);color:var(--four);">2</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start dot-four"></div>
          <div class="arrow-line line-four">
            <span class="msg-label label-four">ACK</span>
            <span class="msg-desc">seq=400, ack=301 &nbsp;"Got your FIN, still sending..."</span>
          </div>
          <div class="dot-end dot-four"></div>
        </div>
      </div>

      <div class="step" id="four-s3" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(255,107,107,0.15);color:var(--four);">3</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start dot-four"></div>
          <div class="arrow-line line-four">
            <span class="msg-label label-four">FIN</span>
            <span class="msg-desc">seq=401 &nbsp;"Now I'm done too"</span>
          </div>
          <div class="dot-end dot-four"></div>
        </div>
      </div>

      <div class="step" id="four-s4" style="margin-bottom:0.5rem">
        <span class="step-num" style="background:rgba(255,107,107,0.15);color:var(--four);">4</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start dot-four"></div>
          <div class="arrow-line line-four">
            <span class="msg-label label-four">ACK</span>
            <span class="msg-desc">seq=301, ack=402 &nbsp;"Connection closed ‚úì"</span>
          </div>
          <div class="dot-end dot-four"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-card">
      <div class="label">Round Trips</div>
      <div class="value c-four">2.0 RTT</div>
    </div>
    <div class="info-card">
      <div class="label">Messages</div>
      <div class="value c-four">4 total</div>
    </div>
    <div class="info-card">
      <div class="label">Why separate ACK+FIN?</div>
      <div class="value" style="color:var(--four);font-size:0.75rem">Full-duplex ‚Äî each side closes independently</div>
    </div>
    <div class="info-card">
      <div class="label">Security</div>
      <div class="value" style="color:var(--four)">Strongest</div>
    </div>
  </div>

  <div class="use-cases">
    <h3>Real-World Examples</h3>
    <div class="use-list">
      <span class="use-tag" style="color:var(--four);border-color:rgba(255,107,107,0.3)">TCP connection close</span>
      <span class="use-tag" style="color:var(--four);border-color:rgba(255,107,107,0.3)">WPA2 Wi-Fi auth</span>
      <span class="use-tag" style="color:var(--four);border-color:rgba(255,107,107,0.3)">WebSocket close frame</span>
      <span class="use-tag" style="color:var(--four);border-color:rgba(255,107,107,0.3)">IoT device pairing</span>
    </div>
  </div>
</div>

<!-- ===================== HALF-CLOSE + RECONNECT ===================== -->
<div class="diagram-container" id="d-half">
  <div class="diagram-header">
    <div class="badge" style="color:#f9a825;border:2px solid #f9a825;background:rgba(249,168,37,0.06)">¬Ω+3</div>
    <div class="header-text">
      <h2>Half-Close + Reconnect</h2>
      <p>Client closes ‚Üí Server still active ‚Üí Client reconnects via new 3-Way</p>
    </div>
  </div>

  <!-- Alert box -->
  <div style="background:rgba(249,168,37,0.08);border:1px solid rgba(249,168,37,0.4);border-radius:0.7rem;padding:0.9rem 1.2rem;margin-bottom:1.2rem;font-family:'JetBrains Mono',monospace;font-size:0.75rem;color:#f9a825;">
    ‚ö†Ô∏è &nbsp;<strong>Key Rule:</strong> TCP does NOT allow reusing a half-closed connection. The client must open a <em>brand new</em> TCP connection with a new SYN handshake ‚Äî it cannot "un-close" its side.
  </div>

  <div class="controls">
    <button class="play-btn" style="border-color:#f9a825;color:#f9a825;" onclick="animate('half')">‚ñ∂ ANIMATE</button>
  </div>

  <div class="canvas">
    <div class="actors">
      <div class="actor">
        <div class="actor-icon" style="background:rgba(249,168,37,0.08);border:1.5px solid #f9a825">üíª</div>
        <div class="actor-label">Client</div>
      </div>
      <div class="actor">
        <div class="actor-icon" style="background:rgba(249,168,37,0.08);border:1.5px solid #f9a825">üñ•Ô∏è</div>
        <div class="actor-label">Server</div>
      </div>
    </div>

    <div class="lifelines">
      <div class="lifeline-client"></div>
      <div class="lifeline-server"></div>

      <!-- Phase label: HALF-CLOSE -->
      <div style="text-align:center;font-family:'JetBrains Mono',monospace;font-size:0.65rem;letter-spacing:0.1em;color:#f9a825;background:rgba(249,168,37,0.08);border:1px solid rgba(249,168,37,0.2);border-radius:0.3rem;padding:0.2rem 0.6rem;margin-bottom:1.2rem;">
        ‚îÄ‚îÄ PHASE 1 : CLIENT HALF-CLOSE ‚îÄ‚îÄ
      </div>

      <div class="step" id="half-s1" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(249,168,37,0.15);color:#f9a825;">1</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start" style="background:#f9a825"></div>
          <div class="arrow-line" style="background:#f9a825">
            <span class="msg-label" style="background:rgba(249,168,37,0.15);color:#f9a825;">FIN</span>
            <span class="msg-desc">seq=300 &nbsp;"I'm done sending"</span>
          </div>
          <div class="dot-end" style="background:#f9a825"></div>
        </div>
      </div>

      <div class="step" id="half-s2" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(249,168,37,0.15);color:#f9a825;">2</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start" style="background:#f9a825"></div>
          <div class="arrow-line" style="background:#f9a825">
            <span class="msg-label" style="background:rgba(249,168,37,0.15);color:#f9a825;">ACK</span>
            <span class="msg-desc">seq=400, ack=301 &nbsp;"OK. I'll keep sending data..."</span>
          </div>
          <div class="dot-end" style="background:#f9a825"></div>
        </div>
      </div>

      <!-- Server still sending data -->
      <div class="step" id="half-s3" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(249,168,37,0.15);color:#f9a825;">3</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start" style="background:#f9a825"></div>
          <div class="arrow-line" style="background:#f9a825;border-top:2px dashed #f9a825;height:0;background:none;">
            <span class="msg-label" style="background:rgba(249,168,37,0.15);color:#f9a825;">DATA</span>
            <span class="msg-desc">Server continues sending remaining data to client</span>
          </div>
          <div class="dot-end" style="background:#f9a825"></div>
        </div>
      </div>

      <!-- Phase label: CLIENT WANTS TO RECONNECT -->
      <div style="text-align:center;font-family:'JetBrains Mono',monospace;font-size:0.65rem;letter-spacing:0.1em;color:#b388ff;background:rgba(179,136,255,0.08);border:1px solid rgba(179,136,255,0.2);border-radius:0.3rem;padding:0.2rem 0.6rem;margin-bottom:1.2rem;">
        ‚îÄ‚îÄ PHASE 2 : CLIENT RECONNECTS (NEW 3-WAY HANDSHAKE) ‚îÄ‚îÄ
      </div>

      <div class="step" id="half-s4" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(179,136,255,0.15);color:#b388ff;">4</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start" style="background:#b388ff"></div>
          <div class="arrow-line" style="background:#b388ff">
            <span class="msg-label" style="background:rgba(179,136,255,0.15);color:#b388ff;">SYN</span>
            <span class="msg-desc">seq=500 (new ISN) &nbsp;"New connection request"</span>
          </div>
          <div class="dot-end" style="background:#b388ff"></div>
        </div>
      </div>

      <div class="step" id="half-s5" style="margin-bottom:2.5rem">
        <span class="step-num" style="background:rgba(179,136,255,0.15);color:#b388ff;">5</span>
        <div class="arrow-row arrow-left">
          <div class="dot-start" style="background:#b388ff"></div>
          <div class="arrow-line" style="background:#b388ff">
            <span class="msg-label" style="background:rgba(179,136,255,0.15);color:#b388ff;">SYN-ACK</span>
            <span class="msg-desc">seq=600, ack=501 &nbsp;"OK, new connection ready"</span>
          </div>
          <div class="dot-end" style="background:#b388ff"></div>
        </div>
      </div>

      <div class="step" id="half-s6" style="margin-bottom:0.5rem">
        <span class="step-num" style="background:rgba(179,136,255,0.15);color:#b388ff;">6</span>
        <div class="arrow-row arrow-right">
          <div class="dot-start" style="background:#b388ff"></div>
          <div class="arrow-line" style="background:#b388ff">
            <span class="msg-label" style="background:rgba(179,136,255,0.15);color:#b388ff;">ACK</span>
            <span class="msg-desc">seq=501, ack=601 &nbsp;"Connected! ‚úì"</span>
          </div>
          <div class="dot-end" style="background:#b388ff"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="info-grid">
    <div class="info-card">
      <div class="label">State after step 2</div>
      <div class="value" style="color:#f9a825;font-size:0.8rem">Client: FIN_WAIT_2<br>Server: CLOSE_WAIT</div>
    </div>
    <div class="info-card">
      <div class="label">Can client reuse old conn?</div>
      <div class="value" style="color:#ff6b6b">‚úó Never</div>
    </div>
    <div class="info-card">
      <div class="label">Solution</div>
      <div class="value" style="color:#b388ff;font-size:0.78rem">Brand new 3-way SYN</div>
    </div>
    <div class="info-card">
      <div class="label">New ISN (seq)</div>
      <div class="value" style="color:#b388ff;font-size:0.78rem">Random, not seq+1</div>
    </div>
  </div>

  <div class="use-cases">
    <h3>Why a new random ISN?</h3>
    <div style="font-family:'JetBrains Mono',monospace;font-size:0.75rem;color:var(--muted);line-height:1.7;">
      The new SYN uses a <span style="color:#b388ff">fresh random Initial Sequence Number (ISN)</span> ‚Äî NOT seq=301. This prevents old stale packets from the previous connection being mistaken for new ones. It also guards against <span style="color:#ff6b6b">sequence prediction attacks</span>.
    </div>
  </div>
</div>

<!-- COMPARISON TABLE -->
<div class="comparison">
  <h3>// Side-by-Side Comparison</h3>
  <table>
    <tr>
      <th>Property</th>
      <th style="color:var(--two)">2-Way</th>
      <th style="color:var(--three)">3-Way</th>
      <th style="color:var(--four)">4-Way</th>
    </tr>
    <tr>
      <td style="color:var(--muted)">Messages</td>
      <td class="c-two">2</td>
      <td class="c-three">3</td>
      <td class="c-four">4</td>
    </tr>
    <tr>
      <td style="color:var(--muted)">Round trips</td>
      <td class="c-two">1.0 RTT</td>
      <td class="c-three">1.5 RTT</td>
      <td class="c-four">2.0 RTT</td>
    </tr>
    <tr>
      <td style="color:var(--muted)">Bidirectional confirm</td>
      <td style="color:#ff6b6b">‚úó</td>
      <td style="color:var(--three)">‚úì</td>
      <td style="color:var(--four)">‚úì‚úì</td>
    </tr>
    <tr>
      <td style="color:var(--muted)">Security level</td>
      <td class="c-two">Low</td>
      <td class="c-three">Medium</td>
      <td class="c-four">High</td>
    </tr>
    <tr>
      <td style="color:var(--muted)">Primary purpose</td>
      <td class="c-two">Request/Reply</td>
      <td class="c-three">Connection open</td>
      <td class="c-four">Connection close</td>
    </tr>
    <tr>
      <td style="color:var(--muted)">Latency cost</td>
      <td class="c-two">Lowest</td>
      <td class="c-three">Medium</td>
      <td class="c-four">Highest</td>
    </tr>
  </table>
</div>

<script>
  function show(type) {
    document.querySelectorAll('.diagram-container').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => { t.className = 'tab'; });
    document.getElementById('d-' + type).classList.add('active');
    const tabs = document.querySelectorAll('.tab');
    const map = { two: 0, three: 1, four: 2, half: 3 };
    const activeClass = { two: 'active-two', three: 'active-three', four: 'active-four', half: 'active-half' };
    tabs[map[type]].classList.add(activeClass[type]);
    setTimeout(() => animate(type), 100);
  }

  function animate(type) {
    const counts = { two: 2, three: 3, four: 4, half: 6 };
    const n = counts[type];
    for (let i = 1; i <= n; i++) {
      const step = document.getElementById(type + '-s' + i);
      if (step) {
        const row = step.querySelector('.arrow-row');
        if (row) row.classList.remove('visible');
      }
    }
    for (let i = 1; i <= n; i++) {
      const step = document.getElementById(type + '-s' + i);
      if (step) {
        const row = step.querySelector('.arrow-row');
        if (row) setTimeout(() => row.classList.add('visible'), i * 550);
      }
    }
  }

  // Auto-animate on load
  setTimeout(() => animate('two'), 300);
</script>
</body>
</html>